
<!DOCTYPE html>
<html>
<head>
<title>新竹市產業發展潛力分析地圖</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" rel="stylesheet">

 <style>
#map {
 height: 90%;
 width: 100%;
 padding:0px;
 margin:auto 0;
}

html,body{
  height:100%;
}
.btn{
  margin-top:5px;
cursor:pointer;
font-family:Microsoft JhengHei;
}
.head-banner{
  background-color:#282c37;
color:white;
}
	  
.attr_bar{
 width:80%;
 background-color:RGB(0,78,102);
}

.attr_value{
 width:80%;
 background-color:RGB(111,203,218);
}

.attr_str{
 text-align:right;
 color:white;
 background-color:RGB(111,203,218);
}

 </style> 
 
</head>
 
 
 
<body>

<div class="container-fluid" style="height:100%">
  <div class="row" style="height:100%">
    <div class="col-md-12 head-banner" style="height:10%">
       <label style="text-align:center">新竹市產業發展潛力分析地圖</label>
       <p id="update_time"></p>
    </div>
	
	<div class="col-md-8 col-xs-12" id="map">
    </div>
    
	<div class="col-md-4 col-xs-12">
	  
	  <div id = "test">
	      
	  </div>
	  
	</div>
  </div>
</div> 
 
<script>


//////////////////google maps////////////////////////////
var rectangle;
var map;
var infoWindow;
var population_list = [];
var rank;
var pr;
var jdata;
var rec_object_list = [];
var bounds=[];
$.ajax(
   {
     url:"https://togetherhoo.github.io/JS/hsinchucity_fishnet.json",
     async: false,
     type:"GET",
     dataType: "json",
     success: function(Adata){
     jdata = Adata;
	 },
	 error:function(){
     },
    });

console.log(jdata)

//座標的排序不一定會照大小，所以先把所有經緯度分別抓到latlist和lonlist，再把兩個陣列由小到大排序，最後取第0個和第4個就會分別是最大和最小值
for (var i=0;i < jdata.features.length; i++){
    var latlist = [];
	var lonlist = [];
	for (var j=0;j<jdata.features[i].geometry.coordinates[0].length;j++){
	    coord = jdata.features[i].geometry.coordinates[0][j]
		latlist.push(coord[0]);
		lonlist.push(coord[1]);
	};
	latlist = latlist.sort(function(a,b){return a-b});
	lonlist = lonlist.sort(function(a,b){return a-b});
	n = lonlist[4];
	w = latlist[0];
	s = lonlist[0];
	e = latlist[4];
	bound = {
	    north:n,
		west:w,
		south:s,
		east:e
	};
	bounds.push(bound);
};
//console.log("bounds",bounds);

function initMap() {

    map = new google.maps.Map(document.getElementById('map'), {
          zoom: 11,
          center: {lat: jdata.features[0].geometry.coordinates[0][0][1], lng: jdata.features[0].geometry.coordinates[0][0][0]}
        });

    function createRectangle(boundary,pop,house) {
    var rectangle = new google.maps.Rectangle({
        bounds:boundary,
		strokeColor: "#000",
        strokeOpacity: 1.0,
        strokeWeight: 0.5,
		fillColor:"#000",
		map:map
	}); 
	rec_object_list.push(rectangle);
	
	rectangle.population = pop;
	rectangle.households = house;
	
	population_list.push(pop);
	population_list = population_list.sort(function(b,a){return a-b});
    console.log(population_list);
	
	google.maps.event.addListener(rectangle,"mouseover",function(){
	    rectangle.setOptions({
	        strokeColor : "#FF0000",
	        strokeWeight: 2
	    });
	});
	google.maps.event.addListener(rectangle,"mouseout",function(){
	    rectangle.setOptions({
	        strokeColor : "#000",
	        strokeWeight: 0.5
	    });
	});
    google.maps.event.addListener(rectangle, "click", function() { 
        rec_object_list.forEach((val) => {
		    val.setOptions({
			    fillColor:"#000"
			});
		});
		rectangle.setOptions({
	        fillColor:"RGB(13,122,121)"
	    });
		
		//顯示圖表訊息
		rank = population_list.indexOf(rectangle.population) + 1;
        pr = ((population_list.length - rank) / (population_list.length) * 100) + "%";
        $("#test").text("");
        var html_str = "<label>人口</label>" ;
	    html_str +=  '<div class="attr_bar">';
	    html_str += '<div class="attr_str attr_value"  style="width:' + pr + ';">';
	    html_str += '<p>' + rectangle.population + '</p>';
	    html_str += '</div>';
	    html_str += '</div>';
	    $(".attr_value").css("width",pr);
	    $("#test").append(html_str);
	    var test_str = "此區域的人口數是" + rectangle.population + "人";
	    $("#test").append(test_str);
		
    });
	
    return rectangle;  
    }

rec0 = createRectangle(bounds[0],jdata.features[0].properties.population,jdata.features[0].properties.households);
rec1 = createRectangle(bounds[1],jdata.features[1].properties.population,jdata.features[1].properties.households);
rec2 = createRectangle(bounds[2],jdata.features[2].properties.population,jdata.features[2].properties.households);
rec3 = createRectangle(bounds[3],jdata.features[3].properties.population,jdata.features[3].properties.households);
rec4 = createRectangle(bounds[4],jdata.features[4].properties.population,jdata.features[4].properties.households);
rec5 = createRectangle(bounds[5],jdata.features[5].properties.population,jdata.features[5].properties.households);
rec6 = createRectangle(bounds[6],jdata.features[6].properties.population,jdata.features[6].properties.households);
rec7 = createRectangle(bounds[7],jdata.features[7].properties.population,jdata.features[7].properties.households);
rec8 = createRectangle(bounds[8],jdata.features[8].properties.population,jdata.features[8].properties.households);
rec9 = createRectangle(bounds[9],jdata.features[9].properties.population,jdata.features[9].properties.households);
	
 };
 
 
</script>

<script src="https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/markerclusterer.js">
</script>
	
<script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDW2R3JvnGX3WPGyv2NOH_TbprbOIFmBuc&libraries=visualization&callback=initMap">
</script>

</body>
 
 
</html>
